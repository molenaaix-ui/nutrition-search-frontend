<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Cloudflare ç‡Ÿé¤Šæ•¸æ“šæœå°‹ (å…©æ®µå¼æŸ¥è©¢)</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <style>
Â  Â  Â  Â  /* è®“è¡¨æ ¼åœ¨å°è¢å¹•ä¸Šå¯ä»¥æ²å‹• */
Â  Â  Â  Â  .details-table-container {
Â  Â  Â  Â  Â  Â  overflow-x: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* çªå‡ºé¡¯ç¤ºå¯ç·¨è¼¯çš„é‡é‡è¼¸å…¥æ¡† */
Â  Â  Â  Â  .weight-input {
Â  Â  Â  Â  Â  Â  width: 45px; /* é™åˆ¶å¯¬åº¦ */
Â  Â  Â  Â  Â  Â  text-align: right;
Â  Â  Â  Â  Â  Â  border: 1px solid #3b82f6; /* è—è‰²é‚Šæ¡† */
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  padding: 2px 4px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  background-color: #eff6ff; /* æ·ºè—è‰²èƒŒæ™¯ */
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">

Â  Â  <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-8">
Â  Â  Â  Â  <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">ç‡Ÿé¤Šæ•¸æ“šå³æ™‚æœå°‹ (å…©æ®µå¼æŸ¥è©¢)</h1>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  <input type="text" id="search-input" placeholder="è«‹è¼¸å…¥å•†å“åç¨±ã€åˆ†é¡æˆ–å“ç‰Œ..."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  oninput="performSearchDebounced()">
Â  Â  Â  Â  </div>

        <div class="mb-6 grid grid-cols-3 gap-3">
            <select id="filter-category" 
                    class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500"
                    onchange="updateFilterOptions('category'); performSearchDebounced();">
                <option value="">[æ‰€æœ‰åˆ†é¡]</option>
            </select>
            <select id="filter-type" 
                    class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500"
                    onchange="updateFilterOptions('type'); performSearchDebounced();" disabled>
                <option value="">[æ‰€æœ‰é¡å‹]</option>
            </select>
            <select id="filter-content" 
                    class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500"
                    onchange="performSearchDebounced();" disabled>
                <option value="">[æ‰€æœ‰å…§å®¹]</option>
            </select>
        </div>
        Â  Â  Â  Â Â 
Â  Â  Â  Â  <p id="status-text" class="text-gray-500 mb-4 text-sm">è«‹è¼¸å…¥é—œéµå­—é€²è¡Œæœå°‹ (ä¾‹å¦‚ï¼šè²æœã€æ‹¿éµ)</p>

Â  Â  Â  Â  <div id="results-container" class="hidden">
Â  Â  Â  Â  Â  Â  <div id="results-list" class="space-y-2 border border-gray-200 rounded-lg p-3 bg-white">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="mt-4 text-center">
Â  Â  Â  Â  Â  Â  <button id="load-more-btn"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="loadMore()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="hidden px-6 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition duration-150 shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed">
Â  Â  Â  Â  Â  Â  Â  Â  è¼‰å…¥æ›´å¤š (å°šé¤˜ ?? ç­†)
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="no-results" class="hidden text-center py-10">
Â  Â  Â  Â  Â  Â  <p class="text-xl font-semibold text-red-500">ğŸ˜­ æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„å•†å“ã€‚</p>
Â  Â  Â  Â  Â  Â  <p class="text-gray-500 mt-2">è«‹å˜—è©¦ä½¿ç”¨å…¶ä»–é—œéµå­—ï¼Œæˆ–æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯åˆ¥å­—ã€‚</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="details-container" class="hidden mt-8">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-gray-800 mb-4" id="details-item-name"></h2>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button onclick="hideDetails()"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="mb-4 px-4 py-1 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-150">
Â  Â  Â  Â  Â  Â  Â  Â  â† è¿”å›æœå°‹çµæœ
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="details-table-container shadow-md rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  <table class="min-w-full divide-y divide-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead class="bg-blue-600 text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">å“å</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">å‚™è¨»</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">é‡é‡(g)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">ç†±é‡(kcal)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">è›‹ç™½è³ª(g)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">è„‚è‚ª(g)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">é£½å’Œè„‚è‚ª(g)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">åå¼è„‚è‚ª(g)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">ç¢³æ°´åŒ–åˆç‰©(g)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">ç³–(g)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">éˆ‰(mg)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-3 py-3 text-left text-xs font-medium tracking-wider">æ“ä½œ</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="details-tbody" class="bg-white divide-y divide-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <p id="copy-status" class="hidden mt-3 text-sm font-semibold text-green-600">
Â  Â  Â  Â  Â  Â  Â  Â  âœ… ç‡Ÿé¤Šæ•¸æ“šå·²æˆåŠŸè¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼Œå¯è²¼åˆ° Excelã€‚
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

<script>
    // ----------------------------------------------------
    // ã€ä¿®æ”¹é» 1: API ç¶²å€èˆ‡å…¨åŸŸè®Šæ•¸ã€‘
    // ----------------------------------------------------
Â  Â  const API_URL = 'https://nutrition-search-worker.food-data.workers.dev';Â 
    // æ–°å¢ç¯©é¸å™¨ API ç¶²å€
    const FILTER_API_URL = 'https://nutrition-filters.food-data.workers.dev/';
    
    // å…¨åŸŸè®Šæ•¸ï¼Œå„²å­˜å¾ API ç²å–çš„éšå±¤å¼ç¯©é¸å™¨è³‡æ–™
    let ALL_FILTER_DATA = {}; 

Â  Â  // --- ç‹€æ…‹ç®¡ç† ---
Â  Â  const ITEMS_PER_PAGE = 20;
Â  Â  let allResults = [];Â 
Â  Â  let currentStartIndex = 0;Â 
Â  Â  let originalItemData = {}; // å„²å­˜è©²ç­†è³‡æ–™çš„åŸå§‹ç‡Ÿé¤Šæ•¸æ“šå’Œæ¯ g åƒ¹å€¼
Â  Â  // -----------------------

Â  Â  const searchInput = document.getElementById('search-input');
Â  Â  const statusText = document.getElementById('status-text');
Â  Â  const resultsContainer = document.getElementById('results-container');Â 
Â  Â  const resultsList = document.getElementById('results-list');Â 
Â  Â  const noResultsDiv = document.getElementById('no-results');
Â  Â  const loadMoreBtn = document.getElementById('load-more-btn');
    
    // æ–°å¢ç¯©é¸å™¨å…ƒç´ å¼•ç”¨
    const filterCategory = document.getElementById('filter-category');
    const filterType = document.getElementById('filter-type');
    const filterContent = document.getElementById('filter-content');
Â  Â Â 
Â  Â  const detailsContainer = document.getElementById('details-container');
Â  Â  const detailsItemName = document.getElementById('details-item-name');
Â  Â  const detailsTbody = document.getElementById('details-tbody');
Â  Â  const copyStatus = document.getElementById('copy-status');

Â  Â  let debounceTimeout;
    
    // ç§»é™¤ Synonyms ç›¸é—œçš„ç¨‹å¼ç¢¼ï¼Œä¸¦å°‡ getExpandedTerms ç°¡åŒ–ç‚ºè¿”å›å–®å€‹è©å½™
    // æ—¢ç„¶ worker.js æ˜¯åŒç¾©è©è¾­å…¸ï¼Œæˆ‘å€‘ä¿ç•™ getExpandedTerms çš„æ®¼ï¼Œä½†ç§»é™¤å…§éƒ¨é‚è¼¯
Â  Â  function getExpandedTerms(term) {
        // ç”±æ–¼æ‚¨æ²’æœ‰æä¾› SYNONYM_MAP å…§å®¹ï¼Œä¸”è¦æ±‚æœ€å°ä¿®æ”¹ï¼Œ
        // é€™è£¡æš«æ™‚å°‡å…¶è¨­å®šç‚ºè¿”å›å–®è©æœ¬èº«ï¼Œä»¥é˜²æ­¢åŸ·è¡Œæ™‚éŒ¯èª¤ã€‚
        // å¦‚æœæ‚¨çš„ Worker æŸ¥è©¢ä¸ä¾è³´å‰ç«¯åŒç¾©è©æ“´å±•ï¼Œå‰‡æ­¤å‡½å¼ä½œç”¨ä¸å¤§ã€‚
Â  Â  Â  Â  return [term.toLowerCase()];
Â  Â  }

Â  Â  // ----------------------------------------------------
    // ã€æ–°å¢ç¯©é¸å™¨åˆå§‹åŒ–å‡½å¼ã€‘
    // ----------------------------------------------------
    async function loadInitialFilters() {
        try {
            const response = await fetch(FILTER_API_URL);
            const data = await response.json();
            
            if (data.filters) {
                ALL_FILTER_DATA = data.filters; // å°‡è³‡æ–™å­˜å…¥å…¨åŸŸè®Šæ•¸
                console.log('ç¯©é¸å™¨è³‡æ–™å·²è¼‰å…¥:', ALL_FILTER_DATA);
            } else {
                 console.error("API ç²å–ç¯©é¸å™¨è³‡æ–™å¤±æ•—:", data);
                 statusText.textContent = 'è­¦å‘Šï¼šç„¡æ³•è¼‰å…¥ç¯©é¸å™¨è³‡æ–™ã€‚';
                 return;
            }
        } catch (error) {
            console.error("é€£ç·šåˆ°ç¯©é¸å™¨ API å¤±æ•—:", error);
             statusText.textContent = 'è­¦å‘Šï¼šç„¡æ³•é€£ç·šåˆ°ç¯©é¸å™¨ APIã€‚';
             return;
        }

        // å¡«å……ã€Œåˆ†é¡ã€é¸å–®
        const categories = Object.keys(ALL_FILTER_DATA).sort();
        
        filterCategory.innerHTML = '<option value="">[æ‰€æœ‰åˆ†é¡]</option>'; 
        
        categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            filterCategory.appendChild(option);
        });

        // åˆå§‹åŒ–å…¶ä»–é¸å–®ç‹€æ…‹
        updateFilterOptions('category');
    }

    // ----------------------------------------------------
    // ã€æ–°å¢ç¯©é¸å™¨é€£å‹•é‚è¼¯å‡½å¼ã€‘
    // ----------------------------------------------------
    function updateFilterOptions(changedFilter) {
        const selectedCategory = filterCategory.value;
        const selectedType = filterType.value;
        const ALL_DATA = ALL_FILTER_DATA; 

        // æ­¥é©Ÿ 1: æ›´æ–°ã€Œé¡å‹ã€é¸å–®
        if (changedFilter === 'category') {
            filterType.innerHTML = '<option value="">[æ‰€æœ‰é¡å‹]</option>';
            filterType.disabled = true;

            if (selectedCategory && ALL_DATA[selectedCategory]) {
                const types = Object.keys(ALL_DATA[selectedCategory]).sort();
                types.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    filterType.appendChild(option);
                });
                filterType.disabled = false;
            }
            // ç”±æ–¼åˆ†é¡è®Šæ›´ï¼Œé¡å‹å’Œå…§å®¹ä¹Ÿéœ€è¦é‡è¨­
            filterType.value = ""; 
            filterContent.value = "";
        }
        
        // æ­¥é©Ÿ 2: æ›´æ–°ã€Œå…§å®¹ã€é¸å–®
        if (changedFilter === 'category' || changedFilter === 'type') {
            filterContent.innerHTML = '<option value="">[æ‰€æœ‰å…§å®¹]</option>';
            filterContent.disabled = true;

            // é‡æ–°è®€å–æœ€æ–°çš„é¡å‹å€¼
            const currentSelectedType = filterType.value; 

            if (selectedCategory && currentSelectedType && ALL_DATA[selectedCategory] && ALL_DATA[selectedCategory][currentSelectedType]) {
                const contents = ALL_DATA[selectedCategory][currentSelectedType]; 
                contents.forEach(content => {
                    const option = document.createElement('option');
                    option.value = content;
                    option.textContent = content;
                    filterContent.appendChild(option);
                });
                filterContent.disabled = false;
            }
            if (changedFilter === 'category') {
                filterContent.value = "";
            }
        }
    }

Â  Â  function performSearchDebounced() {
Â  Â  Â  Â  clearTimeout(debounceTimeout);
Â  Â  Â  Â  debounceTimeout = setTimeout(performSearch, 300);Â 
Â  Â  }
Â  Â Â 
Â  Â  function prepareNewSearch() {
Â  Â  Â  Â  detailsContainer.classList.add('hidden');
Â  Â  Â  Â  resultsContainer.classList.add('hidden');
Â  Â  Â  Â  noResultsDiv.classList.add('hidden');
Â  Â  Â  Â  loadMoreBtn.classList.add('hidden');
Â  Â  Â  Â  resultsList.innerHTML = '';Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  allResults = [];
Â  Â  Â  Â  currentStartIndex = 0;
Â  Â  }

    // ... (deduplicateResults å‡½å¼ä¿æŒä¸è®Š) ...
Â  Â  function deduplicateResults(results) {
Â  Â  Â  Â  const seenNames = new Set();
Â  Â  Â  Â  return results.filter(item => {
Â  Â  Â  Â  Â  Â  const name = item['å“å']; 
Â  Â  Â  Â  Â  Â  if (seenNames.has(name)) {
Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  seenNames.add(name);
Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  });
Â  Â  }

Â  Â  /**
Â  Â  Â * ã€ä¿®æ”¹é» 2: ä¿®æ”¹ performSearch å‡½å¼ï¼Œå‚³éç¯©é¸åƒæ•¸ã€‘
Â  Â  Â */
Â  Â  async function performSearch() {
Â  Â  Â  Â  const rawQuery = searchInput.value.trim();
        // ç²å–ç¯©é¸å™¨çš„å€¼
        const category = filterCategory.value;
        const type = filterType.value;
        const content = filterContent.value;
        
Â  Â  Â  Â  if (rawQuery.length < 1 && !category && !type && !content) {
Â  Â  Â  Â  Â  Â  prepareNewSearch();
Â  Â  Â  Â  Â  Â  statusText.textContent = 'è«‹è¼¸å…¥é—œéµå­—æˆ–é¸æ“‡ç¯©é¸æ¢ä»¶é–‹å§‹æœå°‹';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  prepareNewSearch();Â 
Â  Â  Â  Â  let statusDisplay = `æ­£åœ¨æœå°‹ "${rawQuery}"`;
        if (category) statusDisplay += ` (åˆ†é¡:${category}`;
        if (type) statusDisplay += `, é¡å‹:${type}`;
        if (content) statusDisplay += `, å…§å®¹:${content}`;
        if (category) statusDisplay += ')';

Â  Â  Â  Â  statusText.textContent = statusDisplay + '...';

Â  Â  Â  Â  // --- 1. è§£ææŸ¥è©¢ï¼šåˆ†é›¢åŒ…å«é …å’Œæ’é™¤é … (ä¿æŒåŸæœ‰çš„å¤šé—œéµå­—/åŒç¾©è©é‚è¼¯) ---
        // ç”±æ–¼åŒç¾©è©å’Œå¤šé—œéµå­—é‚è¼¯è¤‡é›œï¼Œæˆ‘å€‘å‡è¨­ä¸» Worker åªéœ€è¦ä¸€å€‹æŸ¥è©¢å­—ä¸²
        // é€™è£¡å°‡æ‰€æœ‰ç¯©é¸æ¢ä»¶çµ±ä¸€çµ„åˆæˆä¸€å€‹æŸ¥è©¢å­—ä¸²ï¼Œä¸¦åœ¨å–®æ¬¡ API å‘¼å«ä¸­å®Œæˆ
Â  Â  Â  Â  const singleIncludeTerms = []; 
Â  Â  Â  Â  const excludeTerms = [];Â 
Â  Â  Â  Â  const excludeRegex = /-"([^"]+)"/g;
Â  Â  Â  Â  let match;
Â  Â  Â  Â  let queryForInclusion = rawQuery;

Â  Â  Â  Â  while ((match = excludeRegex.exec(rawQuery)) !== null) {
Â  Â  Â  Â  Â  Â  excludeTerms.push(match[1].trim());Â 
Â  Â  Â  Â  Â  Â  queryForInclusion = queryForInclusion.replace(match[0], ' ');Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  queryForInclusion.split(/\s+/).filter(t => t.length > 0).forEach(term => {
Â  Â  Â  Â  Â  Â  if (!singleIncludeTerms.includes(term)) {
Â  Â  Â  Â  Â  Â  Â  Â  singleIncludeTerms.push(term);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
        // é€™è£¡å°‡ç¯©é¸æ¢ä»¶ä¹ŸåŠ å…¥åˆ°æŸ¥è©¢åƒæ•¸ä¸­ï¼Œç°¡åŒ– API é‚è¼¯
        // å‡è¨­ä¸» Worker API æ”¯æ´ category, type, content åƒæ•¸
Â  Â  Â  Â  const includeTermSets = singleIncludeTerms.map(term => getExpandedTerms(term));

Â  Â  Â  Â  // --- 2. çµ±ä¸€ API å‘¼å« ---
Â  Â  Â  Â  let allApiResults = [];
Â  Â  Â  Â  let totalInitialCount = 0;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const excludeQueryPart = excludeTerms.map(term => ` -"${term}"`).join('');

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // é‡å°æ¯å€‹åŒ…å«é …è¯é›†çš„ç¬¬ä¸€å€‹è©ï¼ˆä½œç‚ºä»£è¡¨ï¼‰é€²è¡Œ API å‘¼å«
Â  Â  Â  Â  Â  Â  const fetchPromises = [];
            
            // å‰µå»º URL æœå°‹åƒæ•¸
            const params = new URLSearchParams();
            if (rawQuery) params.append('q', rawQuery); // é€™è£¡åªå‚³éåŸå§‹çš„ rawQuery çµ¦ Worker
            if (category) params.append('category', category);
            if (type) params.append('type', type);
            if (content) params.append('content', content);
            
            // ç”±æ–¼æ‚¨çš„ Worker API è¨­è¨ˆæ˜¯é‡å°å–®é—œéµå­—æŸ¥è©¢ï¼Œ
            // é€™è£¡ç‚ºäº†ä¿æŒåŸæœ‰çš„åŒç¾©è©å’Œ AND ç¯©é¸é‚è¼¯ï¼Œä»ç„¶éœ€è¦é€²è¡Œå¤šæ¬¡ API å‘¼å«
            // ä½†æ˜¯æˆ‘å€‘**å°‡ç¯©é¸æ¢ä»¶åŠ å…¥åˆ°æ¯å€‹ API å‘¼å«çš„åƒæ•¸ä¸­**

            // ç¢ºä¿è‡³å°‘æœ‰ä¸€çµ„è¦æŸ¥è©¢çš„è©å½™
            const termsToQuery = (includeTermSets.length > 0) ? singleIncludeTerms : ['']; 

Â  Â  Â  Â  Â  Â  termsToQuery.forEach(term => {
                const termSet = getExpandedTerms(term);
Â  Â  Â  Â  Â  Â  Â  Â  termSet.forEach(t => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const promise = (async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // æ¯å€‹æŸ¥è©¢æ˜¯å–®é—œéµå­— + æ’é™¤é … + ç¯©é¸æ¢ä»¶
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const singleApiQuery = `${t}${excludeQueryPart}`;
                        
                        const currentParams = new URLSearchParams();
                        currentParams.append('q', singleApiQuery);
                        if (category) currentParams.append('category', category);
                        if (type) currentParams.append('type', type);
                        if (content) currentParams.append('content', content);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = `${API_URL}?${currentParams.toString()}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log(`å–®ç¨ API æŸ¥è©¢ URL: ${url}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (response.status === 200 && data.data) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return data.data; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchPromises.push(promise);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // ç­‰å¾…æ‰€æœ‰ API å‘¼å«å®Œæˆ
Â  Â  Â  Â  Â  Â  const resultsArrays = await Promise.all(fetchPromises);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // åˆä½µæ‰€æœ‰çµæœä¸¦è¨ˆç®—ç¸½æ•¸
Â  Â  Â  Â  Â  Â  resultsArrays.forEach(arr => {
Â  Â  Â  Â  Â  Â  Â  Â  totalInitialCount += arr.length;
Â  Â  Â  Â  Â  Â  Â  Â  allApiResults.push(...arr);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // ç§»é™¤åˆä½µçµæœä¸­çš„é‡è¤‡é …ç›® (é‡è¦ï¼šè¯é›†çµæœéœ€è¦å»é‡)
Â  Â  Â  Â  Â  Â  allApiResults = deduplicateResults(allApiResults);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let filteredResults = allApiResults;Â 

Â  Â  Â  Â  Â  Â  // --- 3. å‰ç«¯åŸ·è¡Œåš´æ ¼çš„ AND ç¯©é¸ (åŸºæ–¼åŒç¾©è©è¯é›†) ---
Â  Â  Â  Â  Â  Â  if (includeTermSets.length > 1) { // åªæœ‰åœ¨æœ‰å¤šå€‹å–®è©æ™‚æ‰åŸ·è¡Œ AND ç¯©é¸
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  filteredResults = allApiResults.filter(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const itemNameLower = item['å“å'].toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ç¢ºä¿å“åå°æ–¼æ¯å€‹ã€Œé—œéµå­—è¯é›†çµ„ã€éƒ½èƒ½è‡³å°‘åŒ¹é…ä¸€å€‹è©å½™
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return includeTermSets.every(termSet => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // æª¢æŸ¥ termSet (ä¾‹å¦‚: ['è²æœ', 'ç„™æœ']) ä¸­æ˜¯å¦æœ‰ä»»ä¸€è©å½™åœ¨å“åä¸­
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return termSet.some(term => itemNameLower.includes(term));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // ------------------------------------

Â  Â  Â  Â  Â  Â  allResults = filteredResults;Â 
Â  Â  Â  Â  Â  Â  const totalCount = allResults.length;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (totalCount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  // è¨ˆç®—ç¯©é¸è³‡è¨Šï¼ˆç¸½å…±å¾å¤šå°‘ç­†ä¸é‡è¤‡çš„çµæœä¸­ç¯©é¸ï¼‰
Â  Â  Â  Â  Â  Â  Â  Â  const finalInitialCount = allApiResults.length;
Â  Â  Â  Â  Â  Â  Â  Â  let queryInfo = (finalInitialCount !== totalCount) ? ` (å·²å¾ ${finalInitialCount} ç­†ä¸é‡è¤‡çµæœä¸­ç¯©é¸)` : '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  resultsList.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderResults(allResults, 0, ITEMS_PER_PAGE);

Â  Â  Â  Â  Â  Â  Â  Â  const itemsShown = Math.min(ITEMS_PER_PAGE, totalCount);
Â  Â  Â  Â  Â  Â  Â  Â  statusText.innerHTML = `å·²æ‰¾åˆ° ${totalCount} ç­†çµæœã€‚ç›®å‰é¡¯ç¤º ${itemsShown} ç­†ã€‚${queryInfo}`;
Â  Â  Â  Â  Â  Â  Â  Â  resultsContainer.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  updateLoadMoreButton();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  statusText.textContent = `æ‰¾ä¸åˆ°èˆ‡ç•¶å‰æ¢ä»¶ç›¸é—œçš„çµæœã€‚`;
Â  Â  Â  Â  Â  Â  Â  Â  noResultsDiv.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error('Fetch error (ç¶²è·¯æˆ– JSON è§£æéŒ¯èª¤):', error);
Â  Â  Â  Â  Â  Â  statusText.textContent = `é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ API ç¶²å€æˆ–ç¶²è·¯ã€‚`;
Â  Â  Â  Â  Â  Â  resultsContainer.classList.add('hidden');
Â  Â  Â  Â  }
Â  Â  }

    // --- (å…¶é¤˜è¼”åŠ©å‡½å¼ä¿æŒåŸæ¨£ï¼Œå› ç‚ºå®ƒå€‘èˆ‡ç¯©é¸å™¨ç„¡é—œ) ---
    // ... renderResults, formatNumericValue, showDetails, recalculateNutrition, hideDetails, copyData, loadMore, updateLoadMoreButton

    // ----------------------------------------------------
    // ã€åˆå§‹åŒ–ã€‘
    // ----------------------------------------------------
    // é é¢è¼‰å…¥æ™‚ï¼Œåˆå§‹åŒ–ç¯©é¸å™¨
    window.onload = loadInitialFilters;

</script>
</body>

</html>